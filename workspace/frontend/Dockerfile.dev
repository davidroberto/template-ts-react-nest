FROM node:25-slim

WORKDIR /app

# Copy root package.json for workspace configuration
COPY package.json ./

# Copy workspace package.json files (maintain same structure as host)
COPY workspace/frontend/package*.json ./workspace/frontend/
COPY workspace/shared/package*.json ./workspace/shared/
COPY workspace/backend/package*.json ./workspace/backend/

# Install workspace dependencies with platform-specific builds
RUN npm install --force

# Copy shared source
COPY workspace/shared ./workspace/shared

# Copy frontend source
COPY workspace/frontend ./workspace/frontend

WORKDIR /app/workspace/frontend

EXPOSE 3000

CMD ["sh", "-c", "npm run dev"]
