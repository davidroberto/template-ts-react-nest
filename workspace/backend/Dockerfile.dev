FROM node:25-slim

WORKDIR /app

RUN apt-get update \
  && apt-get install -y --no-install-recommends procps \
  && rm -rf /var/lib/apt/lists/*

# Copy root package.json for workspace configuration
COPY package.json ./

COPY workspace/backend/package*.json ./workspace/backend/
COPY workspace/shared/package*.json ./workspace/shared/

RUN npm install

COPY workspace/shared ./workspace/shared
RUN cd workspace/shared && npm run build

COPY workspace/backend ./workspace/backend

WORKDIR /app/workspace/backend

EXPOSE 5000

CMD ["sh", "-c", "npm run build && npm run start:dev"]